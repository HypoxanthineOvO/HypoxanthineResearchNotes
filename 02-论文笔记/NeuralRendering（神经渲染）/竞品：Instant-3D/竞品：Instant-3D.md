# Abstract

基于神经辐射场 (NeRF) 的 3D 重建非常适合沉浸式增强现实和虚拟现实 (AR/VR) 应用，**但实现即时（即 < 5 秒）设备上 NeRF 训练仍然是一个挑战。** 在这项工作中，我们首先确定了效率低下的瓶颈：在每次训练迭代期间，需要从 3D Embedding Grid 中进行 interpolation 多达 200,000 次。 为了缓解这种情况，我们提出了 Instant-3D，这是一种算法-硬件协同设计加速框架，可实现设备上的**即时 NeRF 训练。** 我们的算法根据颜色和密度分解嵌入网格表示，通过采用不同的

1. 网格大小
2. 颜色和密度

的分支的更新频率来降低计算冗余。

我们的硬件加速器则通过

1. 在前馈过程中将多个附近点的内存读取请求映射到一个
2. 在反向过程中合并来自同一滑动时间窗口的嵌入网格更新，进一步减少了嵌入网格插值的主要内存访问。 传播，以及
3. 融合不同的计算核心

来支持 Instant-3D 算法的颜色和密度分支所需的不同网格大小。 大量实验验证了 Instant-3D 的有效性，在保持相同重建质量的同时实现了 41× - 248× 的大量训练时间减少。 令人兴奋的是，Instant-3D 实现了 AR/VR 的即时 3D 重建，每个场景重建时间仅需 1.6 秒，满足 AR/VR 1.9 W 的功耗限制。

# Introduction

即时 3D 重建已成为众多增强和虚拟现实 (AR/VR) 应用程序的一项基本任务，这些应用程序涉及快速变化的环境 [11、12、39]，例如虚拟房间规划器 [2]、VR 绘画 [ 31]、元宇宙 3D 资产创建 [34] 和虚拟远程呈现 [3]。 具体来说，3D 重建从 3D 场景的一组稀疏采样视图中获取 2D 图像作为其输入，然后从任何所需的新视图生成同一场景的图像。 与卸载到云端相比，即时 3D 重建可以提供更小的通信数据大小和增强的隐私保护。 例如，可以使用 20 MB 的重建模型 [22] 代替 120 MB 的 jpeg 图像 [10]。 这种替代方案对于互联网连接不稳定或不可用的应用场景至关重要，例如虚拟远程呈现 [3]，在这种情况下，每个与会者的环境都需要在不同的互联网带宽下以 < 2 秒的延迟重建 [23、25]。

在致力于推进可实现的三维重建质量的巨大努力中，基于神经辐射场（NeRF）的重建已经脱颖而出[22]，因为它在逼真的重建质量方面具有最先进的（SOTA）性能。然而，虽然在AR/VR设备上对新场景进行即时（即<5秒[24]）的基于NeRF的重建在许多新兴应用中释放出逼真的三维重建的巨大前景是非常可取的，但即使使用最有效的SOTA NeRF训练算法，它仍然不可能实现[24]。

为了弥补上述差距，我们首先着手了解并确定限制基于NeRF的新场景训练重建的可实现运行效率的关键瓶颈。为此，我们首先对最有效的NeRF训练算法，即 **Instant-NGP**[24]，在多个具有不同功耗水平（例如10W∼20W）的商业设备上进行广泛的剖析测量。之后，我们对Instant-NGP[24]训练流程中每个步骤的运行时间进行了各种分析，并找到了关键瓶颈：从 3D Embedding Grid 插值 的步骤及其相应的反向传播过程。这一步的目的是在重建过程中生成要重建的场景中的三维点的嵌入，其中包括相应的点的颜色和密度信息。这个步骤在每次训练迭代中需要执行 200,000 次以上，以确保逼真的重建质量。特别是，正如第2.2节中所讨论和分析的那样，这个步骤的繁重工作量占据了整个管道训练运行时间的80%左右。

为了解决上述的低效率瓶颈，我们开发了一个算法-硬件协同设计加速框架，并做出了以下贡献：

- 我们全面剖析了最有效的 NeRF 训练算法流程在多个设备上的运行瓶颈，并确定了效率低下的主要：**对 3D Embedding Grid 进行插值**，这个步骤在每次训练的迭代中要进行超过 200000 次
- 我们开发了一个名为 Instant-3D 的算法-硬件协同设计加速框架，用于训练NeRFs，据我们所知，这是第一个实现基于NeRF的即时设备三维重建的框架。具体来说，Instant-3D的目标是通过开发专用算法和硬件创新来解决上述的低效率问题，这些算法和硬件创新压缩了存储需求、计算数量和三维嵌入网格插值的瓶颈步骤中的访问数量。
- 在算法层面上，利用我们发现颜色和密度在压缩 NeRFs 时有不同的敏感性，我们建议在确定的瓶颈处 **decompose the aforementioned embedding grid** ，然后对产生的颜色和密度分支采用不同的 **Grid Size** 和 **Update Frequencies** ，允许正交地 sqeezing 两个分支的计算冗余而不影响重建质量。
- 在硬件层面，我们提出了一个专门的加速器，利用上述算法的特性来提高硬件效率，同时进一步减少NeRFs所需的 Embedding Grid interpolation 期间的主要内存访问。后者利用了我们的发现，即嵌入网格插值期间的内存访问模式在要重建的场景的特定区域内是可预测的，如4.2节所示。具体来说，我们的 Instant-3D 加速器强调：
    1. 一个 Feed Forward Read Mapper ，在NeRF训练的前馈过程中，将附近多个点的嵌入的内存读取请求映射成一个读取请求
    2. Back-Propogation Update Merger，在NeRF训练的反向传播阶段将来自同一滑动时间窗口的多个嵌入网格更新合并为一个更新
    3. 基于多核融合的可重构方案，以融合不同的计算核心，支持Instant-3D算法的颜色和密度分支所需的不同网格大小
- 对NeRF Synthetic、SILVR 和ScanNet 的基准实验和消融研究多次验证了 Instant-3D 的有效性，实现了训练运行减少41×-248×，同时保持了与最有效的NeRF训练方案一样的重建质量。令人兴奋的是，Instant-3D为AR/VR实现了即时的基于NeRF的三维重建，在NeRFSynthetic[22]数据集上，每个场景只需要1.6秒就能达到25的体面重建PSNR（图像表示法可接受[20, 38]），同时满足AR/VR 1.9W的功耗限制。

# Instant-3D: Proposed Algorithm

在这一节中，我们介绍了我们提出的 Instant 3D算法。首先，我们假设在压缩NeRFs时，颜色和密度特征具有不同的敏感性，因此在NeRF训练期间可以以不同的速度发展。如第3.1节所述，我们的假设已经在不同数据集的一致定性观察和量化分析的基础上得到经验验证。第二，为了缓解Instant-NGP中嵌入网格插值时的训练运行时间瓶颈，我们通过将嵌入网格解耦为颜色和密度部分来利用上述验证的敏感性差异。具体来说，这为采用(1)不同的网格大小（见第3.2节）和(2)不同的更新频率（见第3.3节）来处理上述三维嵌入网格的颜色和密度分支提供了机会。通过这种方式，可以在两个分支中自适应地挤出计算冗余，以提高整体训练效率，而不影响重建质量。

![[02-论文笔记/NeuralRendering（神经渲染）/竞品：Instant-3D/images/Untitled.png|Untitled.png]]

Figure 5：(a) 训练期间的颜色和密度特征可视化：在相同次数的训练迭代下，Color 比 Density 学习得更快。 在这里我们可以看到，在 Ficus 场景 [22] 上，在相同训练迭代次数（即第 160 次迭代）下，颜色特征的质量高于密度特征，其中显示了 Ground Truth 颜色和密度特征作为参考。 (b) 整个训练过程中颜色和密度特征的量化 PSNR：在整个训练过程中，颜色特征的 PSNR 始终高于密度特征的 PSNR。 这里的图显示了八个场景上的平均 RGB/Depth 图像 PSNR 与训练迭代次数的关系。

## **3.1 Different Paces of Color and Density During Training**

为了验证我们的假设，即**颜色和密度特征对NeRFs的重建质量具有不同的敏感性**，因此在NeRFs训练期间可以以不同的速度发展，我们进行了广泛的可视化实验和分析。两者都一致验证了我们的假说。这里我们说明和讨论一组实验结果。[[竞品：Instant-3D]]是在相同的训练迭代次数（这里共160次）下，同一场景的重建的RGB图像和深度图像的可视化。值得注意的是，深度图像不是在训练过程中产生的，在这里只是用来测试学习到的密度质量。我们可以看到，**在相同的训练迭代下，颜色信息的学习效果比密度信息的学习效果要好，因为重建的榕树的RGB颜色更接近地面真相，而由学习的密度特征决定的榕树的精细几何形状，与地面真相的对应物相比仍然不够清晰。**同时，为了进一步量化颜色和密度特征的差异，[[竞品：Instant-3D]]显示了整个训练轨迹中重建的颜色和密度特征的峰值信噪比（PSNR）（数值越高，对应的重建质量越好）。在八个不同的数据集上，PSNR与训练历时数的平均值显示，在NeRF训练期间，颜色特征的学习速度比密度的学习速度快。例如，颜色和密度特征进化到 24dB PSNR 的质量，总共需要160次迭代 / 200次迭代。我们猜测，上述观察结果是由颜色和密度的不同优化引起的，即训练损失（ $\displaystyle \mathcal{L}=\sum_{r\in\mathcal{R}}\left[\Vert(\hat{\mathbb{C}}(\mathbb{r})-\mathbb{C}(\mathbb{r})\Vert_2^2\right]$ ）是基于预测的颜色而不是预测的密度，表明优化颜色更容易，因此颜色特征对模型压缩不那么敏感。在我们上述关于NeRF训练期间颜色和密度特征的不同敏感性和速度的发现的激励下，我们建议将嵌入网格分解为颜色网格和密度网格。通过这种方式，我们可以探索采用不同网格大小和不同更新频率的可能性，正如下面两个小节所讨论和分析的那样，分解后的分支。

## 3.2 Different Grid Sizes for the Color and Density Branches

### Observation

利用上述发现和我们提出的嵌入网格的分解，我们建议对分解后的嵌入网格所产生的颜色和密度分支采用不同的网格大小，目的是在不损害所实现的重建质量的情况下减少训练时间。

表 1：当密度网格 $S_D$ 和颜色网格 $S_C$ 采用不同的网格尺寸时，在 NeRF Synthetic的八个场景上实现的重建质量 (PSNR) 与所需的训练时间。 这里的训练运行时间是在edge GPU 上测量的。

![[02-论文笔记/NeuralRendering（神经渲染）/竞品：Instant-3D/images/Untitled 1.png|Untitled 1.png]]

表1 显示了我们的验证结果。1显示了我们在重建PSNR与测量的训练时间方面的一组验证实验，其中我们改变了密度网格大小 $S_D$ 和颜色网格大小 $S_C$ ，从 $S_D:S_C=0.25:1$ 到 $S_D : S_C = 1 : 0.25$ 。我们有两个发现：

1. 与 InstantNGP 中对两个网格采用相同的网格大小相比，对颜色和密度网格采用**不同的网格大小**会导致更好的 PSNR 与训练运行时间 trade-off 。特别是，与 InstantNGP 相比，这样做可以减少 $12.5\%$ 的训练运行时间，同时保持相同的 PSNR 。
2. 当颜色特征的网格大小减少时，其敏感性不如密度特征。特别是，当颜色网格大小或密度网格大小减少到 Instant-NGP 中大小的0.25倍时，实现的重建PSNR分别为 26.0 dB 与 25.4 dB ，表明前者对网格大小的敏感性较低（即空间冗余度较高）。

### Proposal Technique

基于我们上面的发现和一致的观察，我们建议对颜色网格使用比密度网格更小的网格大小，即我们在 Instant-3D算法中确保 $S_D>S_C$，如图6所示的可视化。

## 3.3 Different Update Frequencies for the Color and Density Branches

### Observation

在类似的动机下，我们建议对分解后的嵌入网格所产生的颜色和密度分支采用不同的更新频率，以减少训练时间而不损害重建的质量。

表 2：当对密度网格 $𝐹_𝐷$ 和颜色网格 $𝐹_𝐶$ 采用不同的更新频率时，在 NeRF Synthetic [22] 的八个场景上实现的重建质量 (PSNR) 与所需的训练时间。 这里的训练运行时间是在edge GPU 上测量的。

![[02-论文笔记/NeuralRendering（神经渲染）/竞品：Instant-3D/images/Untitled 2.png|Untitled 2.png]]

表2显示了我们的一组验证结果。2显示了我们在实现重建PSNR与测量训练时间方面的一组验证实验，其中我们改变了密度网格𝐹𝐷和颜色网格𝐹𝐶的更新频率，从 $F_𝐷：𝐹_𝐶=0.5:1$ 到 $𝐹_D：𝐹_𝐶=1:0.5$ 。同样地，我们有两个发现：

1. 与 Instant-NGP 中对两者采用相同的更新频率相比，对颜色和密度网格采用不同的更新频率会导致更好的PSNR与训练运行时间权衡。具体来说，与Instant-NGP[24]相比，这样做可以减少 $9.7\%$ 的训练运行时间，同时保持类似的PSNR。
2. 当更新频率降低时，颜色特征比密度特征更不敏感。特别是，当颜色或密度网格的更新频率降低到 Instant-NGP 中对应值的 $0.5$ 倍时，实现的重建PSNR分别为25.9dB和24.3dB，表明前者对更新频率的敏感性较低（即，时间冗余度较高）。

### Proposal Technique

同样，我们建议对颜色网格使用比密度网格更低的更新频率，即在我们的即时3D算法中， $𝐹_𝐷 > 𝐹_𝐶$。

![[02-论文笔记/NeuralRendering（神经渲染）/竞品：Instant-3D/images/Untitled 3.png|Untitled 3.png]]

# **Instant-3D: Proposaled Accelerator**

略过，不太懂

# Evaluation

在本节中，我们首先在第5.1节中介绍了评估我们提出的 Instant-3D 框架的详细设置，然后在第5.2节和第5.3节中分别对我们提出的Instant-3D算法和加速器进行基准测试。

## **5.1 Evaluation Settings**

### Datasets & Baselines.

数据集： 为了评估我们提出的Instant-3D的重建质量和训练效率，我们在常用的NeRF-Synthetic 、大规模的 SILVR 和真实世界捕获的 ScanNet 数据集上进行了实验。重建质量由相应测试集的PSNR来衡量。基线： 我们将三种商业硬件设备作为基准，包括典型功耗为 10W 的 Jetson Nano 、典型功耗为 15W 的 Jetson TX2 和典型功耗为 20W 的 Xavier NX 。我们强调，就我们所知，我们提出的 Instant-3D是第一个为基于NeRF的三维重建训练开发的加速器，因此没有专门的NeRF训练加速器基线可以比较。所有基线和我们的 Instant-3D 的硬件规格总结在表3。请注意，我们不以 RT-NeRF 和 ICRUAS 为基准，它们是先前关于NeRF加速的工作，因为它们只能进行NeRF推理而不是NeRF训练，不能支持所需的即时设备上的三维重建。

### **Instant-3D Algorithm Implementation**

提出的 Instant-3D 算法的实现是基于开源的 Instant-NGP 的官方CUDA实现。除了密度网格的大小和更新频率，我们遵循 Instant-NGP 中的默认算法设置，即： $S_D$ 和 $𝐹_𝐷$ ，以及颜色网格的大小和更新频率，即 $𝑆_𝐶$ 和 $𝐹_𝐶$ ，它们被设置为 $𝑆_D : 𝑆_𝐶 = 1 : 0.25$ ， $𝐹_𝐷 : 𝐹_𝐶 = 1 : 0.5$ 。这样的配置被选为最能压缩训练成本，但也能保持与 Instant-NGP 相同的重建质量，是从 $1 : 0.125$ ， $1 : 0.25$ ， $1 : 0.5$ 和 $1 : 0.75$ 进行网格搜索。因此，为了实现 $𝑆_𝐷 : 𝑆_𝐶 = 1 : 0.25$ ，一维哈希表存储的密度网格和颜色网格分别有 $2^{16}$ 和 $2^{18}$ entries ，并且每个条目都有 $2$ 个 Feature，遵循 Instant NGP。此外，为了实现 $𝐹_𝐷 : 𝐹_𝐶 = 1 : 0.5$ ，密度网格通过重建损失的反向传播每次迭代更新，颜色网格每两次迭代更新。

### **Instant-3D Accelerator Implementation**

为了评估所提出的 Instant-3D 加速器的能量和面积，我们在 RTL 中实现了我们的加速器，使用 Synopsys 设计编译器合成RTL设计，然后使用 Cadence Innovus 对设计进行放置和布线，基于商业28nm CMOS技术。在我们所有的实验中，根据经验观察，我们把我们提出的 FRM 和 BUM 单元的重新排序流水线深度设定为16，并发现它普遍适用于我们实验中的所有数据集；而且连接到 FRM 和BUM单元的每个SRAM阵列可以处理8个独特的内存访问。具体来说，我们在所有与算法相关的计算中使用16位半精度浮点运算，以确保量化造成的渲染质量下降最小。此外，我们开发了一个周期精确的模拟器来估计我们提出的 Instant-3D 加速器在不同数据集上的训练效率，假设 DRAM 带宽为59.7GB/s，这与基线硬件设备 Jetson TX2 和 Xavier NX 中使用的 LPDDR4-1866 的典型 DRAM 带宽相同。拟议的Instant-3D加速器的面积为 6.8 mm2，平均功耗为1.9 W，如图15所示。

## **5.2 Instant-3D Algorithm’s Performance**

### **Benchmark with the SOTA Efficient NeRF Training Algorithm**

![[02-论文笔记/NeuralRendering（神经渲染）/竞品：Instant-3D/images/Untitled 4.png|Untitled 4.png]]

为了评估我们在第3节中的 Instant-3D 算法的有效性，我们将其与最有效的NeRF训练算法 Instant-NGP 进行了比较，即在边缘 GPU Xavier NX 上实现重建PSNR和训练运行时间。如 表4 所示。我们可以看到，我们提出的 Instant-3D 算法在重建质量与训练运行时间的权衡方面超过了最有效的NeRF训练算法，例如，60秒与72秒达到相同的质量（ NeRF-Synthetic 8个场景的平均 PSNR 为 26.0 ）。

### **Benchmark with the SOTA Efficient NeRF Training Devices.**

![[02-论文笔记/NeuralRendering（神经渲染）/竞品：Instant-3D/images/Untitled 5.png|Untitled 5.png]]

我们在 [[竞品：Instant-3D]] 中总结了我们提出的 Instant-3D 加速器实现的 NeRF 训练效率改进。具体来说，与NeRF-Sythetic 的三个基线相比，拟议的Instant-3D加速器分别比Jetson Nano / Jetson TX2 /Xavier NX 平均提供 224×/132×/45× 的速度和 1198×/1089×/479× 的能源效率。具体来说，我们的 Instant-3D 比 Xaiver NX 的速度提高了 45 倍，这是由于（1）Instant-3D算法提高了2.7倍，（2）我们的 FRM 和 BUM 单元提高了3.1倍，这是受第4.2节中观察到的内存访问模式的启发，以及（3）通过更好的硬件调度，即我们基于多核融合的 reconfigurable scheme 提高了 5.3 倍，如图17中所示。

### Ablation Study on the Effectiveness of the Proposed FRM and BUM Units.

正如第4.4节和第4.5节所说明的，我们提出了一个FRM单元来充分利用片上多组SRAM阵列，以及一个BUM单元来尽量减少所需的SRAM写入数量。为了验证这两个单元的有效性，我们在图18中总结了没有FRM单元或BUM单元的Instant-3D运行时间。特别是，提议的FRM单元可以将运行时间平均缩短31.1%。此外，在FRM单元的基础上加上BUM单元，运行时间减少率可以进一步扩大到68.6%，这表明对于我们的Instant-3D加速器来说，拟议的FRM单元和BUM单元都是必要的，以实现预期的基于设备的即时NeRF重建。值得注意的是，据我们所知，CUDA的API目前不支持对FRM和BUM单元所需的精确/细粒度内存访问的控制，在表3中总结的基准设备上。

![[02-论文笔记/NeuralRendering（神经渲染）/竞品：Instant-3D/images/Untitled 6.png|Untitled 6.png]]

## **Ablation Study on Necessity of Co-Design.**

![[02-论文笔记/NeuralRendering（神经渲染）/竞品：Instant-3D/images/Untitled 7.png|Untitled 7.png]]

据我们所知，我们提出的 Instant-3D ，作为一个算法-硬件代码设计加速框架，是第一个实现即时的基于NeRF的三维重建。为了验证这种共同设计策略的必要性，我们在 表5 中总结了我们的Instant-3D的运行时间（不包括提议的算法技术或硬件技术）。具体来说，与最有效的NeRF训练算法[24]相比，在相同的边缘GPU Xavier NX 上，使用我们提出的Instant-3D算法，我们可以将运行时间缩短到83.0%。此外，使用我们提出的Instant-3D算法和加速器，运行时间可以减少到最有效的NeRF训练方案（ Instant-NGP 在 Xavier NX 上）的2.2%，这表明我们 Instant-3D 框架的协同设计策略的必要性。